<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="./dist/main.css" />
        <script src="./dist/main.js"></script>
        <title>Custom Map</title>

        <style>
            #container {
                height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: row;
            }
            #map {
                height: 80vh;
                width: 80vh;
            }
            html, body {
                margin: 0;
                padding: 0;
            }
            #vertical-list {
                width: 200px;
                height: 80vh;
                overflow-y: auto;
            }
            #vertical-list li {
                background-color: black;
                color: yellow;
                display: block;
                padding: 12px;
                text-decoration: none;
            }
            #vertical-list li:hover {
                background-color: rebeccapurple;
            }
            #vertical-list li.active {
                background-color: #4caf50;
                color: white;
            }
            #info {
                border: 2px solid black;
                height: 80vh;
                width: 300px;
            }
        </style>
    </head>

    <body>
        

        <div id="container">
            <div id="info">
                <h1>Location Info</h1>
                <ul id="info-list">
                    <li> Title and Creator: <span id = "name"></span></li><br>
                    <li> Arist Info Website: <a href="#"><span id="artist-link"></span></a></li><br>
                    <li> Type and Material: <span id="physical"></span></li><br>
                    <li> Location: <span id="location"></span></li><br>
                    <li> Access: <span id="access"></span></li>

                </ul>
                <img>
            </div>
            <div id="map"></div>
            <ul id="vertical-list">
                <li>tester</li>
            </ul>
        </div>

        <script>
            //this script takes the csv file, cleans info and returns a matrix of each location and it's info
            // getData();

            async function getData() {
            
                const finalData = [];

                const response = await fetch("src/data/Map_of_Public_Art__from_1__Art_Program_.csv")
                const data = await response.text();
                const table = data.split("\n").slice(1);
                

                table.forEach(row => {
                    const locationInfo = row.split(',');
                    finalData.push(locationInfo);
                })


                let testData = finalData.slice(0)
                return testData;
            }
            
        </script>

        
        <!-- <script src="index.pack.js">
            //this script holds the drop pin function, currently set to take in a class instance
        </script> -->

        <script>

            function dropPin(locationClass, map) {
                    let geocoder = new google.maps.Geocoder();
                    let createdMap = map;
                    let address = locationClass.address;
                    // let position = locationClass.location.geometry.location

                    geocoder.geocode({ 'address': address }, function (results, status) {
                        if (status === 'OK') {
                            let marker = new google.maps.Marker({
                                map: createdMap,
                                position: results[0].geometry.location,
                                label: locationClass.name,
                                icon: 'https://www.google.com/mapfiles/arrow.png'
                            });

                            let infoWindow = new google.maps.InfoWindow({
                                content: locationClass.name
                            });
                            marker.addListener('click', function () {
                                infoWindow.open(map, marker);
                                //add function that loads the location attributes into the #info div
                                document.getElementById('name').textContent = locationClass.name;
                                document.getElementById('physical').textContent = locationClass.type;
                                document.getElementById('location').textContent = locationClass.address;
                                document.getElementById('artist-link').textContent = locationClass.link;
                                document.getElementById('access').textContent = locationClass.access;
                            })
                        } else {
                            alert('Geocode was not successful for the following reason:' + status);
                        }
                    });

                }








            function LocationClass (arr) {
                    this.address = arr[0];
                    // this.coords = arr[0].geometry.location;
                    this.name = arr[1];
                    this.type = arr.slice(2, 4).join(' ');
                    this.access = arr[4] + arr[5];
                    this.link = arr.last;
            }
            //This script initializes the map to the html div
            async function initMap() {

                    //centers map on sf
                let mapOptions = {
                    center: {lat: 37.77493, lng: -122.419415},
                    zoom: 12
                }
                //initializes map and connect it to html
                let map = new google.maps.Map(document.getElementById('map'), mapOptions);
                //initializes geocoder obj to convert each street address to coords for pin placement
                let geocoder = new google.maps.Geocoder();
                //loads the array of location info
                let tester = await getData();

                //iterates through data matrix returned by async 'getData' function, creates an li with each name
                //need to add event listener and bind class instance to li element
                tester.forEach(location => {
                    let newLocation = new LocationClass(location);
                    

                    // let address = location[0];
                    // let name = location[1];
                    // let type = location.slice(2,4).join(', ');
                    // let access = location.slice(4, 6).join(', ');
                    // //some locations don't have artist links, need helper function to test arr length and obj for url
                    // let link = location.pop();

                        let node = document.createElement("LI");
                        let textnode = document.createTextNode(newLocation.name);
                        node.appendChild(textnode);
                        document.getElementById('vertical-list').appendChild(node);

                        node.addEventListener('click', function() {
                            
                            dropPin(newLocation, map);
                            document.getElementById('name').textContent = newLocation.name;
                            document.getElementById('physical').textContent = newLocation.type;
                            document.getElementById('location').textContent = newLocation.address;
                            document.getElementById('artist-link').textContent = newLocation.link;
                            document.getElementById('access').textContent = newLocation.access;
                        })
                    

                    // geocoder.geocode({ 'address': address }, function (results, status) {
                    //     if (status === 'OK') {
                    //         let marker = new google.maps.Marker({
                    //             map: map,
                    //             position: results[0].geometry.location,
                    //             // label: name,
                    //             icon: 'https://www.google.com/mapfiles/arrow.png'
                    //         });

                    //         let infoWindow = new google.maps.InfoWindow({
                    //             content: name
                    //         });
                    //         marker.addListener('click', function(){
                    //             infoWindow.open(map, marker);
                    //             document.getElementById('name').textContent = name;
                    //             document.getElementById('physical').textContent = type;
                    //             document.getElementById('location').textContent = address;
                    //             document.getElementById('artist-link').textContent = link;
                    //             document.getElementById('access').textContent = access;
                    //         })
                    //     } else {
                    //         alert('Geocode was not successful for the following reason:' + status);
                    //     }
                    // });
                });
            }
            



            //this factory function will be used to create each pin
            //takes an arg of the coordinates
            // function addMarker(coords) {
            //     let marker = new google.maps.Marker({
            //         position:coords,
            //         map:map,
            //         //icon:''
            //     });
            // }
        </script>
            
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDe3sykJUD8na0TQmavoQfLXPW3qkPNukM&callback=initMap"></script>

        
        

        
    </body>
</html>